using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.U2D;
using UnityEngine.UI;

// ***************************************************************
// SCRIPT CODE TEMPLATE GENERATED BY GOOGLE GEMINI TO BE USED!!!!
// ***************************************************************

public class UISticker : MonoBehaviour
{
    [SerializeField]
    private SpriteAtlas _spriteAtlas;
    [SerializeField]
    private string _spriteName;

    // These fields are redundant if using the Handler pattern, but kept for compatibility.
    // public GameObject _confirmationMenu; 
    public ConfirmationMenuHandler confirmHandler;

    private Image stickerImage;


    // Start is called before the first frame update
    void Start()
    {
        stickerImage = GetComponent<Image>();
        stickerImage.sprite = _spriteAtlas.GetSprite(_spriteName);

        // Finding the handler: Use FindObjectOfType for cleaner code than GameObject.Find("Canvas")
        confirmHandler = FindObjectOfType<ConfirmationMenuHandler>();
        if (confirmHandler == null)
        {
            Debug.LogError("ConfirmationMenuHandler not found in scene!");
        }
    }

    // Update is called once per frame
    void Update()
    {
        // ...
    }

    public void StickerClicked()
    {
        Debug.Log("Sticker Selected! Instantiating menu...");

        if (confirmHandler != null && confirmHandler._confirmationMenu != null)
        {
            // 1. Instantiate the Confirmation Menu (Panel)
            GameObject confirmationMenuInstance = Instantiate(
                confirmHandler._confirmationMenu,
                confirmHandler.transform
            );

            // 2. Get the UIConfirmation script from the newly created menu instance
            UIConfirmation uiConfirmation = confirmationMenuInstance.GetComponent<UIConfirmation>();

            if (uiConfirmation != null)
            {
                // 3. CALL the initialization method, passing the required data.
                // This call triggers the sticker instantiation and A-to-B animation.
                uiConfirmation.Initialize(
                    this.transform.position,    // The start position (A)
                    stickerImage.sprite         // The sprite to display
                );
            }
        }
    }
}